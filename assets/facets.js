class FacetFiltersForm extends HTMLElement{constructor(){super(),this.onActiveFilterClick=this.onActiveFilterClick.bind(this),this.debouncedOnSubmit=debounce((e=>{this.onSubmitHandler(e)}),500),this.querySelector("form").addEventListener("input",this.debouncedOnSubmit.bind(this))}static setListeners(){window.addEventListener("popstate",(e=>{const t=e.state?e.state.searchParams:FacetFiltersForm.searchParamsInitial;t!==FacetFiltersForm.searchParamsPrev&&FacetFiltersForm.renderPage(t,null,!1)}))}static renderPage(e,t,r=!0){FacetFiltersForm.searchParamsPrev=e;const s=FacetFiltersForm.getSections(),i=document.getElementById("FacetDrawer"),o=document.getElementById("ProductCount"),a=document.getElementById("ProductCountMobile"),n=document.getElementById("ProductCountDesktop");document.getElementById("ProductGridContainer").querySelector(".collection").classList.add("loading"),o&&o.classList.add("loading"),a&&a.classList.add("loading"),n&&n.classList.add("loading"),i&&i.classList.add("loading"),s.forEach((r=>{const s=`${window.location.pathname}?section_id=${r.section}&${e}`,i=e=>e.url===s;FacetFiltersForm.filterData.some(i)?FacetFiltersForm.renderSectionFromCache(i,t):FacetFiltersForm.renderSectionFromFetch(s,t)})),r&&FacetFiltersForm.updateURLHash(e),document.dispatchEvent(new CustomEvent("collection:reloaded"))}static renderSectionFromFetch(e,t){fetch(e).then((e=>e.text())).then((r=>{const s=r;FacetFiltersForm.filterData=[...FacetFiltersForm.filterData,{html:s,url:e}],FacetFiltersForm.renderFilters(s,t),FacetFiltersForm.renderProductGridContainer(s),FacetFiltersForm.renderProductCount(s)})).catch((e=>{console.error(e)}))}static renderSectionFromCache(e,t){const r=FacetFiltersForm.filterData.find(e).html;FacetFiltersForm.renderFilters(r,t),FacetFiltersForm.renderProductGridContainer(r),FacetFiltersForm.renderProductCount(r)}static renderProductGridContainer(e){document.getElementById("ProductGridContainer").innerHTML=(new DOMParser).parseFromString(e,"text/html").getElementById("ProductGridContainer").innerHTML;const t=document.querySelector("#FacetSortFiltersForm layout-switcher");t&&t.onButtonClick(t.querySelector(".list-view__item--active"))}static renderProductCount(e){const t=(new DOMParser).parseFromString(e,"text/html").getElementById("ProductCount").innerHTML,r=document.getElementById("ProductCount"),s=document.getElementById("ProductCountMobile"),i=document.getElementById("ProductCountDesktop");r&&(r.innerHTML=t,r.classList.remove("loading")),s&&(s.innerHTML=t,s.classList.remove("loading")),i&&(i.innerHTML=t,i.classList.remove("loading"))}static renderFilters(e,t){const r=(new DOMParser).parseFromString(e,"text/html"),s=r.querySelectorAll("#FacetSortFiltersForm .js-filter, #FacetFiltersForm .js-filter, #FacetFiltersFormMobile .js-filter"),i=e=>{const r=t?t.target.closest(".js-filter"):void 0;return!!r&&e.dataset.index===r.dataset.index},o=Array.from(s).filter((e=>!i(e))),a=Array.from(s).find(i);o.forEach((e=>{document.querySelector(`.js-filter[data-index="${e.dataset.index}"]`).innerHTML=e.innerHTML})),FacetFiltersForm.renderActiveFacets(r),FacetFiltersForm.renderAdditionalElements(r),a&&FacetFiltersForm.renderCounts(a,t.target.closest(".js-filter"));const n=document.getElementById("FacetDrawer");n&&n.classList.remove("loading")}static renderActiveFacets(e){[".active-facets-mobile",".active-facets-desktop"].forEach((t=>{const r=e.querySelector(t);r&&(document.querySelector(t).innerHTML=r.innerHTML)}))}static renderAdditionalElements(e){[".mobile-facets__open",".facets__open",".sorting"].forEach((t=>{e.querySelector(t)&&(document.querySelector(t).innerHTML=e.querySelector(t).innerHTML)})),document.getElementById("FacetFiltersFormMobile").closest("facet-drawer").bindEvents()}static renderCounts(e,t){const r=t.querySelector(".facets__selected");e.querySelector(".facets__selected")&&r&&(t.querySelector(".facets__selected").outerHTML=e.querySelector(".facets__selected").outerHTML)}static updateURLHash(e){history.pushState({searchParams:e},"",`${window.location.pathname}${e&&"?".concat(e)}`)}static getSections(){return[{section:document.getElementById("product-grid").dataset.id}]}createSearchParams(e){const t=new FormData(e);return new URLSearchParams(t)}mergeSearchParams(e,t){return this.createSearchParams(e).forEach(((e,r)=>{t.append(r,e)})),t}onSubmitForm(e,t){FacetFiltersForm.renderPage(e,t)}onSubmitHandler(e){e.preventDefault();const t=e.target.closest("form");if("FacetFiltersFormMobile"===t.id){const r=this.createSearchParams(t);this.onSubmitForm(r.toString(),e)}else{let r=new URLSearchParams;if("FacetSortFiltersForm"===t.id&&"drawer"===t.dataset.filterType){const e=document.getElementById("FacetFiltersFormMobile");r=this.mergeSearchParams(e,r),r.delete("sort_by")}document.querySelectorAll("facet-filters-form form").forEach((e=>{"FacetFiltersForm"!==e.id&&"FacetSortFiltersForm"!==e.id||(r=this.mergeSearchParams(e,r))})),this.onSubmitForm(r.toString(),e)}}onActiveFilterClick(e){e.preventDefault(),FacetFiltersForm.renderPage(new URL(e.currentTarget.href).searchParams.toString())}}FacetFiltersForm.filterData=[],FacetFiltersForm.searchParamsInitial=window.location.search.slice(1),FacetFiltersForm.searchParamsPrev=window.location.search.slice(1),customElements.define("facet-filters-form",FacetFiltersForm),FacetFiltersForm.setListeners();class FacetRemove extends HTMLElement{constructor(){super(),this.querySelector("a").addEventListener("click",(e=>{e.preventDefault();(this.closest("facet-filters-form")||document.querySelector("facet-filters-form")).onActiveFilterClick(e)}))}}customElements.define("facet-remove",FacetRemove);class PriceRange extends HTMLElement{constructor(){super(),this.min=Number(this.dataset.min),this.max=Number(this.dataset.max),this.track=this.querySelector(".price-range__track"),this.handles=[...this.querySelectorAll(".price-range__thumbs")],this.startPos=0,this.activeHandle,this.handles.forEach((e=>{e.addEventListener("mousedown",this.startMove.bind(this))})),window.addEventListener("mouseup",this.stopMove.bind(this)),this.querySelectorAll("input").forEach((e=>e.addEventListener("change",this.onRangeChange.bind(this))))}onRangeChange(e){this.adjustToValidValues(e.currentTarget),this.setMinAndMaxValues()}startMove(e){this.startPos=e.offsetX,this.activeHandle=e.target,this.moveListener=this.move.bind(this),window.addEventListener("mousemove",this.moveListener)}move(e){const t=this.activeHandle.classList.contains("is-lower"),r=t?"--progress-lower":"--progress-upper",s=this.track.getBoundingClientRect(),i=this.activeHandle.getBoundingClientRect();let o=e.clientX-s.x-this.startPos;if(t){const e=parseInt(this.style.getPropertyValue("--progress-upper"))*s.width/100;o=Math.min(o,e-i.width),o=Math.max(o,0-i.width/2)}else{const e=parseInt(this.style.getPropertyValue("--progress-lower"))*s.width/100;o=Math.max(o,e),o=Math.min(o,s.width-i.width/2)}const a=(o+i.width/2)/s.width,n=this.calcHandleValue(a);this.style.setProperty(r,100*a+"%"),this.activeHandle.ariaValueNow=n;this.activeHandle.nextElementSibling.querySelector(".price-range__output-text").innerHTML=n;const c=this.querySelectorAll("input"),l=t?c[0]:c[1];l.value=n,this.adjustToValidValues(l),this.setMinAndMaxValues()}calcHandleValue(e){return Math.round(e*(this.max-this.min)+this.min)}stopMove(){window.removeEventListener("mousemove",this.moveListener);const e=this.closest("form");this.activeHandle&&e&&e.dispatchEvent(new Event("input"))}setMinAndMaxValues(){const e=this.querySelectorAll("input"),t=e[0],r=e[1];r.value&&t.setAttribute("max",r.value),t.value&&r.setAttribute("min",t.value),""===t.value&&r.setAttribute("min",0),""===r.value&&t.setAttribute("max",r.getAttribute("max"))}adjustToValidValues(e){const t=Number(e.value),r=Number(e.getAttribute("min")),s=Number(e.getAttribute("max"));t<r&&(e.value=r),t>s&&(e.value=s)}}customElements.define("price-range",PriceRange);class LayoutSwitcher extends HTMLElement{constructor(){super(),this.cookieName="beyours:collection-layout",this.initLayoutMode(),this.querySelectorAll(".list-view__item").forEach((e=>e.addEventListener("click",this.onButtonClick.bind(this))))}onButtonClick(e){const t=e.target?e.target:e;this.changeLayoutMode(t,t.dataset.layoutMode)}initLayoutMode(){if(isStorageSupported("local")){const e=window.localStorage.getItem(this.cookieName);if(null!==e){const t=this.querySelector(`.list-view__item[data-layout-mode="${e}"]`);t&&this.changeLayoutMode(t,e)}}}changeLayoutMode(e,t){const r=document.getElementById("product-grid");if(r.classList.contains("collection--empty"))return;["list","grid","grid--1-col","grid--2-col","grid--3-col-tablet","grid--2-col-desktop","grid--3-col-desktop","grid--4-col-desktop"].forEach((e=>{r.classList.remove(e)}));let s=[];switch(t){case"list":s=["grid","grid--1-col","grid--2-col-desktop","list"];break;case"grid-2":s=["grid","grid--2-col"];break;case"grid-3":s=["grid","grid--2-col","grid--3-col-tablet","grid--3-col-desktop"];break;case"grid-4":s=["grid","grid--2-col","grid--3-col-tablet","grid--4-col-desktop"]}s.forEach((e=>{r.classList.add(e)})),this.querySelectorAll(".list-view__item").forEach((e=>e.classList.remove("list-view__item--active"))),e.classList.add("list-view__item--active"),isStorageSupported("local")&&window.localStorage.setItem(this.cookieName,t)}}customElements.define("layout-switcher",LayoutSwitcher);class StickyFacetFilters extends HTMLElement{constructor(){super()}connectedCallback(){this.onScrollHandler=this.onScroll.bind(this),window.addEventListener("scroll",this.onScrollHandler,!1),this.onScrollHandler()}disconnectedCallback(){window.removeEventListener("scroll",this.onScrollHandler)}onScroll(){(window.pageYOffset||document.documentElement.scrollTop)>this.parentNode.offsetTop?window.requestAnimationFrame(this.reveal.bind(this)):window.requestAnimationFrame(this.reset.bind(this))}reveal(){this.classList.add("shopify-section-filters-sticky")}reset(){this.classList.remove("shopify-section-filters-sticky")}}customElements.define("sticky-facet-filters",StickyFacetFilters);class ShowMoreButton extends HTMLElement{constructor(){super();const e="aria-expanded";this.querySelector(".button-show-more").addEventListener("click",(()=>{const t=this.closest(".js-filter");t.setAttribute(e,("false"===t.getAttribute(e)).toString()),this.querySelectorAll(".visually-hidden").forEach((e=>e.classList.toggle("hidden")))}))}}customElements.define("show-more-button",ShowMoreButton);